# Data feed and reports

Data feeds let Casino Operator to download information about in-game money transactions for all game rounds played and jackpot winnings.
In order to receive Data Feeds data for casino, Operator should follow the flow below:
Call / environments API method with relevant secure Login identifier for casino
In response Kyren will return a list of environment and direct API domains (single or multiple environment domains can be returned)
Operator should call DataFeeds API method from each Environment, using the relevant API domain
In case of multiple domains are returned in Environment API response, Operator should aggregate DataFeeds received from different environments, on their side

Data of the feeds related to large number of records (like transactions) will be requested using time point and sent to the Operator in CSV format.

For each API account, frequency of any particular "Data feeds and reports" method requests, should be not more than one call per minute.
Also, the data can be extracted no later than the last month.



Any "Data feeds and reports" method should be requested only with dataType parameter value, which is available for Operator. 


## Time points
Time point is a timestamp starting from the server time when data is requested for the first time. If the request is sent without a time point, the system returns a time point, which should be sent with the next request.
Whenever a request with the time point is sent, data from the moment of timepoint to the current moment will be transferred, along with the new time point. This new time point should be used for the next request, and so on.
Using such a mechanism, no data will be lost. If clients haven't received response from the Kyren with the new time point, they will be able to re-send the request with the same time point, until requested data is received.


Data can be loaded by small portions for periods of time not longer than 10 minutes.



## Using timepoints for past periods
If Operator needs to get data for a longer period they can send a number of subsequent requests setting up a starting timepoint and then using timepoints that the Kyren system returns in the response.
For example, if Operator needs to get data for the last N minutes, they can calculate the start date and time of the period as Start = (//now/, - N minutes), convert it into timestamp and send request to the Transactions API using this timestamp as a time point. Server will return data for 10 minutes starting from the timestamp sent in the request, along with the new time point. Using timepoints returned by the server and sending requests one after another Operator can get as many portions of data as they need, to download data that are already in the past.


## Data Feed URL

URL of the data feeds service will be provided by Kyren for the production and test environments and looks like :

https://{API service domain}/lntegrationService/v4/DataFeeds/transactions/ 
https://{API service domain}/lntegrationService/v4/DataFeeds/failedtransactions/ 
https://{API service domain}/lntegrationService/v4/JackpotFeeds/jackpots/

Data feeds service is securely protected, hence please be sure:
player's browser (end) must NOT be used as initiator of requests to the service.
proper IPs are supplied to Kyren for whitelisting.

## Data formats
Data will be returned in CSV or JSON format. For more details please see the chapter where the data feed is described.

All successful server responses in CSV format will contain a new time point that should be sent then by the client to the server in the next request. Format of the server response is as follows:
#timepoint = {server time in ms}
{Data in standard csv format}

Client should get the first line from the response, parse it and save the time point somewhere for the next request. The rest of the response should be parsed as normal CSV stream.

## Data types


| Name                    | Data Type | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Remark   |
|:------------------------|:---------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| secureLogin             |string| Partner Id for authentication in the Kyren API service                                                                                                                                                                                                                                                                                                                                                                                                       | Required |
| token                   |string| Token of the Partner from Authenticate response.                                                                                                                                                                                                                                                                                                                                                                                                                   | Required |
| timePoint               |string| Time point.                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| dataType                |string| Type of portfolio. indicates which portfolio Data Feeds should be returned Available options. <br/>RNG - Main portfoliio games (video slot, classic slots etc.) <br/> LC - Live Casino portfolio <br/> VSB - virtual sports betting portfolio. <br/> Important : <br/> In case where data Type is included in reqeust. Data Feeds for relevant portfolio will be returned only. <br/> Whene there is no data Type in request will returned Data Feeds for RNG only | Required |
| playerId                |string| player unique identifier within Lucky Moanco system.                                                                                                                                                                                                                                                                                                                                                                                                               | Required |
| userId                  |string| player unique identifier within Casino Operator system.                                                                                                                                                                                                                                                                                                                                                                                                            | Required |
| gameId                  |string| symbolic unique identified of the game provided by Kyren System.                                                                                                                                                                                                                                                                                                                                                                                            | Required |
| sessionId               |string| Id of the player's session for particular game.                                                                                                                                                                                                                                                                                                                                                                                                                    | Required |
| parentSessionId         |string| Id of the play session, in which the feature was triggered.                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| startDate               |string| Date and time when the game round started.                                                                                                                                                                                                                                                                                                                                                                                                                         | Required |
| endDate                 |string| Date and time when the game round ended.                                                                                                                                                                                                                                                                                                                                                                                                                           | Required |
| status                  |string| Status of the game round, transaction or jackpot.                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| type                    |string| Type of the game round or transaction.                                                                                                                                                                                                                                                                                                                                                                                                                             | Required |
| bet                     |string| Bet amount.                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| win                     |string| Win amount.                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| currency                |string| Currency of the transaction, 3 letter ISO code.                                                                                                                                                                                                                                                                                                                                                                                                                    | Required |
| jackpot                 |string| Jackpot win amount.                                                                                                                                                                                                                                                                                                                                                                                                                                                | Required |
| platform                |string| The platform type (channel) on which the game was played. <br/> Possible value : <br/> U - Unknown <br/> W - WEB <br/> M - mobile                                                                                                                                                                                                                                                                                                                                  | Required |
| bonusCode               |string| Id of the Free Spins Bonus. is applied for rounds, played with FSB.                                                                                                                                                                                                                                                                                                                                                                                                | Required |
| options                 |string| List of settings                                                                                                                                                                                                                                                                                                                                                                                                                                                   | Required |
| timestamp               |string| Date and time when the transaction is processed on the Kyren side.                                                                                                                                                                                                                                                                                                                                                                                          | Required |
| reference               |string| Unique id for reference of this transaction on the Kyren side.                                                                                                                                                                                                                                                                                                                                                                                              | Required |
| amount                  |string| Amount of the transaction.                                                                                                                                                                                                                                                                                                                                                                                                                                         | Required |
| betAmount               |string| Amount of the bet.                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Required |
| winAmount               |string| Amount of winning in current bet.                                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| roundDetails            |string| Additional information about the current game round.                                                                                                                                                                                                                                                                                                                                                                                                               | Required |
| jackpotId               |string| Unique identifier of the jackpot within Lucky Moanaco system.                                                                                                                                                                                                                                                                                                                                                                                                      | Required |
| name                    |string| Name of the Jackpot.                                                                                                                                                                                                                                                                                                                                                                                                                                               | Required |
| level                   |string| level of the Jackpot.                                                                                                                                                                                                                                                                                                                                                                                                                                              | Required |
| games                   |string| The list of the game participating in the Jackpot. It contains gameId (game symbols), comma separated                                                                                                                                                                                                                                                                                                                                                              | Required |
| dateTime                |string| Date and time when the jackpot was won.                                                                                                                                                                                                                                                                                                                                                                                                                            | Required |
| totalRounds             |string| Total number of game rounds.                                                                                                                                                                                                                                                                                                                                                                                                                                       | Required |
| totalFreeSpinRounds     |string| Total number of free spin rounds.                                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| totalBet                |string| Total bet amount.                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| totalWin                |string| Total win amount.                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| totalJackpot            |string| Total Jackpot win amount.                                                                                                                                                                                                                                                                                                                                                                                                                                          | Required |
| totalPromo              |string| Total amount of wins in Prize Drop campaigns.                                                                                                                                                                                                                                                                                                                                                                                                                      | Required |
| startTimePoint          |string| starting Time point.                                                                                                                                                                                                                                                                                                                                                                                                                                               | Required |
| endtTimePoint           |string| Ending Time point.                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Required |
| amountInPlayerCurrency  |string| Amount in player's currency.                                                                                                                                                                                                                                                                                                                                                                                                                                       | Required |
| tier                    |string| Jackpot tier.                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Required |
| payoutstatus            |string| Status of the jackpot payout transaction. <br/> Possible value : <br/> 1 - In progress (not finished yet) <br/> C - Complete <br/> M - Manual                                                                                                                                                                                                                                                                                                                      | Required |
| winType                 |string| Jackpot winning type. possible values : <br/> W - standard jackpot winning <br/> WC - community shared Jackpot winning. <br/> WN - non-progressive jackpot winning                                                                                                                                                                                                                                                                                                 | Required |
| playerCurrencySymbol    |string| Symbol of player's currency                                                                                                                                                                                                                                                                                                                                                                                                                                        | Required |
| finalizedRoundSeparated |string| show completed rounds with status 'C' and finilezed/cancelled (cancelled = 1) round with status 'F'                                                                                                                                                                                                                                                                                                                                                                | Required |
| finalizedRoundHidden    |string| show only completed rounds (exclude finilezed/cancelled round)                                                                                                                                                                                                                                                                                                                                                                                                     | Required |
| uuid                    |string| A unique ID for each request                                                                                                                                                                                                                                                                                                                                                                                                                                       | Required |
| currency                |string| Currency of the User                                                                                                                                                                                                                                                                                                                                                                                                                                               | Required |

